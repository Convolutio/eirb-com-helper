<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Full Width Layout with Form</title>
    <link rel="shortcut icon" href="/img/favicon.png" type="image/x-icon"/>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body, html {
            height: 100%;
            width: 100%;
            display: flex;
            flex-direction: row;
        }

        .left-half, .rendered-content-container {
            width: 50%;
            height: 100%;
	    padding: 30px;
        }


	.left-half form {
            display: flex;
	    height: 100%;
            flex-direction: column;
            justify-content: space-between;
        }

        .input-container {
            height: 90%;
            border: 1px solid #ccc;
            padding: 10px;
            /* You can add padding if you want some spacing inside the form */
        }

	.input-container textarea {
	    flex-grow: 1; /* Ensure it grows to fill the parent div */
	    width: 100%; /* Make sure it takes the full width */
	    height: 100%;
	    border: 1px solid #ccc;
	    padding: 10px;
	    resize: none; /* Optional: Prevent manual resizing */
	    overflow-y: auto; /* Enable vertical scroll when content exceeds */
	}

        .input-row {
            height: 10%;
            display: flex;
            align-items: center;
            padding: 10px;
        }

        .input-row input {
            flex-grow: 1;
            margin-right: 10px;
            padding: 10px;
        }

        .input-row button {
            padding: 10px;
        }

        .rendered-content-container {
            background-color: #f5f5f5;
            border: 1px solid #ccc;
	    overflow-y: auto;
        }
    </style>
    <link rel="stylesheet" href="/output.css"/>
</head>
<body>

    <!-- Left half of the screen with a form -->
    <div class="left-half">
        <form id="dataForm" action="#" method="POST">
            <!-- Main input div taking 90% of the height -->
            <div class="input-container">
                <!-- Add input fields or other form elements here -->
		<textarea id="message" name="message" placeholder="Enter your message"></textarea>
                <!-- Add more form fields as needed -->
            </div>

            <!-- Input and button occupying the remaining 10% of the height -->
            <div class="input-row">
                <input id="chat-id" type="text" placeholder="Enter your chat id" name="chat_id">
                <button type="submit">Submit</button>
            </div>
        </form>
    </div>
    <script src="/send_content.js"></script>

    <!-- Right half of the screen -->
    <div class="rendered-content-container" id="rendered-content">
        <!-- Content for the second half -->
    </div>
    <script type="text/javascript" src="dist/purify.min.js"></script>
    <script type="text/javascript" src="dist/marked.min.js"></script>
    <script type="module">
	marked.use({ gfm: true, breaks: true });

	const markdownContentTextarea = document.getElementById("message");
	const renderedContentDiv = document.getElementById('rendered-content');

	function toMessageHTML(s) {
		const forceLineBreak = (s) => s.replace(/\n\n/g, () => "<br/>\n\n");
		function processSpoilers(s) {
			const parts = s.split("||");
			const firstPart = parts.shift();
			const lastPart = parts.pop();
			return parts.reduce((acc, part) => acc + `<span class="spoiler">${part}</span>`, firstPart) + lastPart;
		}
		return processSpoilers(forceLineBreak(s));
	}

	function renderContent() {
		const markdownContent = markdownContentTextarea.value;
		renderedContentDiv.innerHTML = DOMPurify.sanitize(
			marked.parse(toMessageHTML(markdownContent), { sanitize: true })
		);
	}

	markdownContentTextarea.addEventListener('input', renderContent);
    </script>

</body>
</html>
